{{ define "main" }}

<section>
  <div class="uk-container uk-margin-medium-top">
    <!-- Layer Navigation with Back Button -->
    <div class="uk-margin-medium-bottom layer-nav">
        <div class="uk-flex uk-flex-middle uk-flex-between">
            <div class="uk-flex uk-flex-middle">
                {{ if .Parent }}
                <a href="{{ .Parent.RelPermalink }}" class="back-button" uk-tooltip="Go back to {{ .Parent.Title }}">
                    <span uk-icon="icon: chevron-left"></span>
                </a>
                {{ end }}
                {{ $ancestors := slice }}
                {{ $current := . }}
                {{ if $current.Parent }}
                    {{ $parent := $current.Parent }}
                    {{ $ancestors = $ancestors | append $parent }}
                    {{ if $parent.Parent }}
                        {{ $grandparent := $parent.Parent }}
                        {{ $ancestors = $ancestors | append $grandparent }}
                        {{ if $grandparent.Parent }}
                            {{ $greatgrandparent := $grandparent.Parent }}
                            {{ $ancestors = $ancestors | append $greatgrandparent }}
                        {{ end }}
                    {{ end }}
                {{ end }}
                {{ range after 1 (seq (len $ancestors)) }}
                    {{ $i := sub (len $ancestors) . }}
                    {{ with index $ancestors $i }}
                        <a href="{{ .RelPermalink }}" class="layer-item">{{ .Title }}</a>
                        <span class="uk-margin-small-left uk-margin-small-right layer-separator" uk-icon="icon: chevron-right"></span>
                    {{ end }}
                {{ end }}
                <span class="layer-item current">{{ .Title }}</span>
            </div>
        </div>
    </div>

    <!-- Rest of the content -->
    <h1 class="uk-text-center uk-heading-medium">{{.Title}}</h1>
    <p class="uk-text-center uk-text-lead">{{.Params.description}}</p>
    <p class="uk-text-center">Published on {{ .PublishDate.Format "Jan 02, 2006" }}</p>

    <!-- Points and Solves -->
    <div class="uk-flex uk-flex-center uk-margin-bottom">
      <div class="uk-margin-right">
        <strong>Points:</strong> {{ .Params.points }}
      </div>
      <div>
        <strong>Solves:</strong> {{ .Params.solves }}
      </div>
    </div>

    <!-- Challenge Files -->
    <div class="files-container">
      <ul class="files-grid">
        {{ $files := readDir (printf "/static%s" .Path) }}
        {{ range $files }}
        {{ $fileType := partial "file-type.html" .Name }}
        <li class="file-item">
          <div class="file-wrapper">
            <div class="file-icon" data-type="{{ $fileType.type }}">
              {{ partial "file-icon.html" $fileType }}
            </div>
            <div class="file-info">
              <div class="file-name">{{ .Name }}</div>
              <div class="file-type">{{ $fileType.label }}</div>
            </div>
            <div class="file-actions">
              <a href="{{ .Name }}" class="file-action" target="_blank" aria-label="View file">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </a>
              <a href="{{ .Name }}" class="file-action" download aria-label="Download file">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="7 10 12 15 17 10"></polyline>
                  <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
              </a>
            </div>
          </div>
        </li>
        {{ end }}
      </ul>
    </div>

    <!-- Divider -->
    <hr class="uk-divider-icon">

    <!-- Writeup Content -->
    <div class="content">
      {{ .Content }}
    </div>
  </div>
</section>

<style>
/* Layer Navigation Styles */
.layer-nav {
    padding: 0.75rem 1.25rem;
    background: var(--card-bg);
    border-radius: 12px;
    border: 1px solid var(--card-border);
    box-shadow: 0 1px 4px var(--card-shadow);
}

.layer-item {
    color: var(--text-color-muted);
    text-decoration: none;
    font-size: 0.95rem;
    font-weight: 500;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    transition: all 0.2s ease;
}

.layer-item:not(.current):hover {
    color: var(--link-hover-color);
    background: var(--card-hover-bg);
    text-decoration: none;
}

.layer-item.current {
    color: var(--link-color);
    background: var(--card-hover-bg);
    font-weight: 600;
}

.layer-separator {
    color: var(--text-color-muted);
    opacity: 0.5;
}

/* Back Button Styles */
.back-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: 6px;
    color: var(--text-color-muted);
    background: var(--card-hover-bg);
    margin-right: 12px;
    transition: all 0.2s ease;
}

.back-button:hover {
    color: var(--link-hover-color);
    background: var(--card-bg);
    transform: translateX(-2px);
}

.back-button .uk-icon {
    width: 20px;
    height: 20px;
}

/* Dark Mode Adjustments */
[data-theme="dark"] .layer-nav {
    background: var(--card-bg);
    border-color: var(--card-border);
}

[data-theme="dark"] .layer-item {
    color: var(--card-text-muted);
}

[data-theme="dark"] .layer-item:not(.current):hover {
    color: var(--link-hover-color);
    background: var(--card-hover-bg);
}

[data-theme="dark"] .layer-item.current {
    color: var(--link-color);
    background: var(--card-hover-bg);
}

[data-theme="dark"] .back-button {
    color: var(--card-text-muted);
    background: var(--card-hover-bg);
}

[data-theme="dark"] .back-button:hover {
    color: var(--link-hover-color);
    background: var(--card-bg);
}
</style>

{{ end }}
